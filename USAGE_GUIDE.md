# 🎯 AI チャットボット システム 使用ガイド

## 📋 概要

このシステムは、店舗での受付・案内業務を自動化するためのオフライン対応チャットアプリケーションです。管理画面でコンテンツを編集し、音声ファイルを生成して、チャット画面で顧客対応を行います。

## 🚀 基本的な使い方

### 1. アプリケーション起動

```bash
cd ai-chatbot
npm run dev
```

アプリケーションが `http://localhost:3000` で起動します。

### 2. 画面の種類

- **チャット画面**: `http://localhost:3000` - 顧客向けインターフェース
- **管理画面**: `http://localhost:3000/management` - コンテンツ管理

## 🛠️ 管理画面の使い方

### 基本機能

1. **コンテンツプレビュー**タブ
   - チャットフローの視覚化
   - ノード詳細の確認
   - 音声プレビュー

2. **コンテンツ編集**タブ
   - テキスト編集
   - 翻訳機能（OpenAI API使用）
   - 音声ファイル生成

3. **設定**タブ
   - 店舗情報の編集
   - 言語設定
   - API設定

### 🎤 音声ファイル生成の手順

#### ステップ 1: 話者選択

1. 管理画面の「コンテンツ編集」タブを開く
2. **音声話者選択**セクションで希望の話者を選択
3. **プレビューボタン**で音声を確認

**利用可能な話者:**
- **ずんだもん** (ノーマル/甘え/ツンツン/セクシー)
- **四国めたん** (ノーマル/甘え/ツンツン/セクシー)
- **春日部つむぎ** (ノーマル)
- **雨晴はう** (ノーマル)
- **波音リツ** (ノーマル)
- **玄野武宏** (ノーマル/喜び/ツンツン/悲しみ)

#### ステップ 2: コンテンツ編集

1. 編集したいノードの「編集」ボタンをクリック
2. テキストを編集
3. 必要に応じて「翻訳」ボタンで他言語版を生成

#### ステップ 3: 音声生成

1. 「音声生成」ボタンをクリック
2. 生成が完了すると音声プレビューが表示される
3. 音声ファイルが自動的にダウンロードされる

#### ステップ 4: 一括音声生成

1. 複数のノードを選択（チェックボックス）
2. 「選択した音声を一括生成」ボタンをクリック
3. 進捗状況を確認しながら待機

## 💾 音声ファイルの保存場所

### 自動保存される場所

1. **ブラウザストレージ**: 一時的なBlobURL
2. **ダウンロードフォルダ**: `.wav`ファイルとして自動ダウンロード
3. **ローカルストレージ**: ファイル管理情報

### 手動配置方法

生成された音声ファイルを以下の場所に配置できます：

```
public/
├── audio/
│   ├── ja/
│   │   ├── welcome.wav
│   │   ├── menu.wav
│   │   └── [audioKey].wav
│   └── en/
│       ├── welcome.wav
│       ├── menu.wav
│       └── [audioKey].wav
```

## 🔄 チャット画面との連携

### 音声再生の仕組み

1. **管理画面で生成** → **自動保存** → **チャット画面で再生**
2. 音声ファイルが見つからない場合は**Web Speech API**にフォールバック
3. 一度生成した音声は再利用される

### 音声キー（audioKey）の仕組み

- 各ノードに`voiceFile`プロパティで音声キーを設定
- 例: `welcome` → `welcome.wav`
- 管理画面で生成時に自動的に対応付け

## 🎛️ API設定

### OpenAI API（翻訳用）

1. OpenAI APIキーを取得
2. 環境変数に設定: `NEXT_PUBLIC_OPENAI_API_KEY`
3. または管理画面の設定タブで入力

### VOICEVOX Core（音声生成用）

- **内蔵版を使用**: 外部サーバー不要
- ブラウザ内でWASM版VOICEVOX Coreが動作
- 現在はWeb Speech APIをベースとしたモック実装

## ⚡ パフォーマンス最適化

### 音声ファイル管理

1. **プリロード**: よく使用される音声を事前生成
2. **キャッシュ**: 生成済み音声の再利用
3. **圧縮**: 適切な音質設定で容量削減

### メモリ管理

- 不要になったBlobURLは自動的に解放
- ブラウザ再起動時にキャッシュがクリア

## 🐛 トラブルシューティング

### 音声が雑音になる場合

1. **ブラウザの音声許可**を確認
2. **HTTPS環境**で実行（本番環境）
3. **Web Speech API**の利用可能性を確認

### 音声生成に失敗する場合

1. **インターネット接続**を確認
2. **ブラウザのコンソール**でエラーログを確認
3. **話者ID**が正しいかチェック

### 音声ファイルが保存されない場合

1. **ダウンロード許可**をブラウザで確認
2. **ローカルストレージ**の容量をチェック
3. **ブラウザのセキュリティ設定**を確認

## 📱 動作環境

### 推奨ブラウザ

- **Chrome** 90+
- **Firefox** 90+
- **Safari** 14+
- **Edge** 90+

### 必要な権限

- **マイク**: 音声入力用
- **スピーカー**: 音声出力用
- **ローカルストレージ**: ファイル管理用
- **ダウンロード**: 音声ファイル保存用

## 🔧 開発者向け情報

### 音声ファイル形式

- **形式**: WAV (16bit, 22.05kHz)
- **エンコード**: PCM
- **チャンネル**: モノラル

### カスタム話者追加

1. `voicevoxService.ts`の`availableSpeakers`配列に追加
2. `getSpeakerConfig()`メソッドに音声パラメータを定義
3. `SpeakerSelector`コンポーネントで表示設定

### APIエンドポイント

現在は全てフロントエンド処理:
- VOICEVOX Core: ブラウザ内WASM
- OpenAI API: 直接API呼び出し
- ファイル管理: ブラウザストレージ

## 📞 サポート

技術的な問題や質問がある場合は、開発チームまでお問い合わせください。

---

*このガイドは定期的に更新されます。最新版をご確認ください。*